#!/usr/bin/env python3

__coder__ = 'Ivica Lazarevic'
__scriptName__ = 'proxyHunter.py'
__version__ = '0.1'
__site__ = 'pythonbytes.rs'

import sys
from random import choice
from subprocess import call


try:
    from colorama import Fore
    from bs4 import BeautifulSoup
    from requests import get
except:
    call('pip3 install -r requirements.txt', shell=True)
    exit()


def logo():
    print(Fore.RED+"\n       __           __        ____      __        ")
    print(Fore.RED+"  ____/ /___ ______/ /_______/ __ \____/ /__  _____ ")
    print(Fore.RED+" / __  / __ `/ ___/ //_/ ___/ / / / __  / _ \/ ___/ ")
    print(Fore.RED+"/ /_/ / /_/ / /  / ,< / /__/ /_/ / /_/ /  __/ /     ")
    print(Fore.RED+"\__,_/\__,_/_/  /_/|_|\___/\____/\__,_/\___/_/      ")
    print(Fore.RED+"                                                \n")
    print(Fore.RED+'                               Naziv: '+ __scriptName__)
    print(Fore.RED+'                               Verzija: '+ __version__)
    print(Fore.RED+'                               Koder: '+ __coder__)
    print(Fore.RED+ '                               Sajt: ' + __site__+Fore.WHITE)

if sys.platform == 'linux' or sys.platform == 'linux2' or sys.platform == 'darwin':
    call('clear', shell=True)
    logo()
else:
    call('cls', shell=True)
    logo()

PROXY_SAJTOVI = ['https://www.sslproxies.org/', 'https://free-proxy-list.net', 'https://us-proxy.org/', 'https://www.proxy-list.download/HTTPS', 'https://www.proxy-list.download/HTTP']
PROVERA_PROXY = ['https://httpbin.org/ip', 'http://icanhazip.com']

with open('userAgents.txt') as ua:
    randomUserAgents = ua.readlines()

stranica = get(choice(PROXY_SAJTOVI))
soup = BeautifulSoup(stranica.content, 'html.parser')

PROXIES = []
WORKING_PROXIES = []

for proxy in soup.tbody.find_all('tr'):
    PROXIES.append(proxy.find_all('td')[0].string + ':' + proxy.find_all('td')[1].string)

print(f'\n[+] Ukupan broj proxy servera za proveru: {len(PROXIES)}\n')

for p in PROXIES:
    randomUserAgent = {'User-Agent' : str(choice(randomUserAgents).strip())}
    try:
        odgovor = get(choice(PROVERA_PROXY), proxies={'http':'http://'+p, 'https':'https'+p}, timeout=5, headers=randomUserAgent)
        print(f'[+] Proxy funkcionise: {Fore.RED+p+Fore.WHITE}')
        WORKING_PROXIES.append(p)

    except(KeyboardInterrupt):
        exit('[-] Skripta prekinuta sa radom!')
    except:
        pass

print(f'\n[+] Broj proxy servera koji funkcionisu: {Fore.RED+str(len(WORKING_PROXIES))+Fore.WHITE}')