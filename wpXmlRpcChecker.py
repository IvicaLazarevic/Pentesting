#!/usr/bin/env python3

__coder__ = 'Ivica Lazarevic'
__scriptName__ = 'wpXmlRpcChecker.py'
__version__ = '0.1'
__site__ = 'pythonbytes.rs'

import sys
from random import choice
from subprocess import call

try:
    import requests
    from colorama import Fore
except:
    call('pip3 install colorama requests', shell=True)
    exit()


def logo():
    print(Fore.RED+"\n       __           __        ____      __        ")
    print(Fore.RED+"  ____/ /___ ______/ /_______/ __ \____/ /__  _____ ")
    print(Fore.RED+" / __  / __ `/ ___/ //_/ ___/ / / / __  / _ \/ ___/ ")
    print(Fore.RED+"/ /_/ / /_/ / /  / ,< / /__/ /_/ / /_/ /  __/ /     ")
    print(Fore.RED+"\__,_/\__,_/_/  /_/|_|\___/\____/\__,_/\___/_/      ")
    print(Fore.RED+"                                                \n")
    print(Fore.RED+'                               Naziv: '+ __scriptName__)
    print(Fore.RED+'                               Verzija: '+ __version__)
    print(Fore.RED+'                               Koder: '+ __coder__)
    print(Fore.RED+ '                               Sajt: ' + __site__+Fore.WHITE)

if sys.platform == 'linux' or sys.platform == 'linux2' or sys.platform == 'darwin':
    call('clear', shell=True)
    logo()
else:
    call('cls', shell=True)
    logo()

randomUserAgents = ['Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; WOW64; Trident/6.0)', 'Opera/9.80 (X11; Linux x86_64; U; en-GB) Presto/2.2.15 Version/10.01']

def wpXmlRcp(sajt, randomUserAgent):
    print('\n[+] Provera da li postoji xmlrpc.php fajl')
    xmlrpcMethod = "<?xml version=\"1.0\"?><methodCall><methodName>system.listMethods</methodName><params></params></methodCall>"
    req = requests.get(sajt + '/xmlrpc.php', timeout=3, headers=randomUserAgent)
    if req.status_code == 405:
        print(f'[!] Pronadjen {Fore.RED}xmlrpc.php{Fore.WHITE} fajl!')
        req = requests.post(sajt, data=xmlrpcMethod, timeout=3, headers=randomUserAgent).text
        if 'wp.getUsersBlogs' in req:
            print(f'[!] Postoji mogucnost da je sajt ranjiv na {Fore.RED}xmlrpc bruteforce{Fore.WHITE} napad!')
        else:
            print('[-] Sajt nije ranjiv na xmlrpc bruteforce napad.')
    else:
        print('[-] Nije pronadjen xmlrpc.php fajl!')


if __name__ == '__main__':
    sajt = input('\n[+] Molimo vas unesite ime sajta za proveru: ').lower()
    if not ((('http://') == (sajt[:7])) or (('https://') == (sajt[:8]))):
        exit('[-] Molimo vas unesite pravilnu adresu sajta!')

    randomUserAgent = {'User-Agent' : str(choice(randomUserAgents))}

    wpXmlRcp(sajt, randomUserAgent)